# LocalCoopOnlinePlayer
  #### 1. What does it do?
  >Allows for 2 people to play a Local Coop 
  >game inside a browser over the network.
  #### 2. How does it work(basic)?
  >Player 1 streams the game in the browser to Player 2 over the internet,
  >while Player 2 sends keypress events over the internet to Player 1 for
  >execution inside Player 1's browser tab.
  #### 3. How does it work(deeper explanation)?
  >Using a bookmarklet Player 1 will inject a script into a browser tab 
  >with the game he wants to stream. The script will stream the \<canvas\>
  >to Player 2 using WEBRTC (wrapper library [PeerJS](https://peerjs.com/)). 
  >Player 2 will use the WEBRTC connection to send information needed for
  > dispatchEvent(new KeyboardEvent()) to Player 1 so those key presses can
  > be simulated inside Player 1's browser tab.
  ## How to use?
  #### Player 1 Steps:
  > 1.Add  to browser
  > 2.   
  
  <(javascript:(function()%7B%2F*%0A%20%20%20%20Loads%20script%20from%20src%20into%20page.%20Will%20return%20promise%20that%0A%20%20%20%20waits%20for%20script%20to%20load.%0A%20*%2F%0Afunction%20loadScript(url)%7B%0A%20%20%20%20let%20script%20%3D%20document.createElement(%22script%22)%3B%0A%20%20%20%20script.src%20%3D%20url%3B%0A%20%20%20%20document.body.appendChild(script)%3B%0A%0A%20%20%20%20return%20new%20Promise((resolve%2Creject)%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20script.addEventListener(%22load%22%2C()%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20resolve(%22File%20loaded%22)%3B%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20script.addEventListener(%22error%22%2Ce%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20reject(e)%3B%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%7D%0A%0A%2F*%0A%20%20%20%20Creates%20a%20peer%20that%20is%20waiting%20for%20a%20connection.Once%0A%20%20%20%20connected%20to%20will%20execute%20all%20key%20presses%20the%20other%20peer%20sends.%0A%20%20%20%20Will%20stream%20selected%20canvas%20to%20other%20peer.%0A%20*%2F%0Afunction%20createPeer(canvas)%7B%0A%20%20%20%20let%20p%20%3D%20new%20Peer()%3B%0A%0A%20%20%20%20%2F%2FDestroys%20connection%20when%20window%20closes%0A%20%20%20%20window.addEventListener(%22beforeunload%22%2C()%20%3D%3E%7B%0A%20%20%20%20%20%20%20p.destroy()%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20p.on(%22open%22%2Cid%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20alert(%22Send%20this%20id%20to%20your%20friend%3A%22%20%2B%20id)%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%2F%2FReceives%20keys%20pressed%20by%20other%20peer%20and%20streams%20canvas%0A%20%20%20%20p.on(%22connection%22%2Cconn%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20%2F%2FOther%20peer%20sends%20over%20json%20with%20type%20of%20keyboard%20event(data.type)%20and%20options(data.options)%0A%20%20%20%20%20%20%20%20conn.on('data'%2Cdata%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20canvas.dispatchEvent(new%20KeyboardEvent(data.type%2Cdata.options))%3B%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2FPrompts%20user%20for%20how%20many%20frames%20to%20stream%20the%20canvas%0A%20%20%20%20%20%20%20%20let%20frames%20%3D%20%2Bprompt(%22Max%20Frame%20cap%20for%20stream(negative%20number%20for%20no%20stream)%22)%3B%0A%20%20%20%20%20%20%20%20if(!isNaN(frames)%20%26%26%20frames%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20stream%20%3D%20canvas.captureStream(frames)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20p.call(conn.peer%2Cstream)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20p.on(%22disconnected%22%2C%20()%20%3D%3E%7B%0A%20%20%20%20%20%20%20p.reconnect()%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20p.on(%22close%22%2C%20()%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20p.destroy()%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20p.on(%22error%22%2C%20e%3D%3E%7B%0A%20%20%20%20%20%20%20%20alert(%22Error%3A%22%20%2B%20e.type%20%2B%20%22.%20Please%20reload%20the%20page%20an%20try%20again%22)%3B%0A%20%20%20%20%7D)%3B%0A%7D%0A%0A%2F*%0A%20%20%20%20Configures%20everything%20to%20be%20able%20to%20stream%20canvas.If%20iframe%20is%20selected%20opens%20in%20new%20tab(need%20to%20rerun%20bookmarklet).%0A%20%20%20%20Else%20will%20try%20to%20establish%20connection%20with%20other%20peer%20and%20stream%20canvas.%0A%20*%2F%0Afunction%20streamCanvas(canvas)%7B%0A%20%20%20%20loadScript(%22https%3A%2F%2Funpkg.com%2Fpeerjs%401.4.5%2Fdist%2Fpeerjs.min.js%22).then(()%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20alert(%22Streaming%20canvas%3A%22%20%2B%20canvas.id)%0A%20%20%20%20%20%20%20%20createPeer(canvas)%3B%0A%20%20%20%20%7D%2C%20error%20%3D%3E%7B%0A%20%20%20%20%20%20%20%20alert(error%20%2B%20%22.%20Terminating%22)%3B%0A%20%20%20%20%7D)%3B%0A%7D%0A%0A%2F%2FIf%20user%20focused%20on%20an%20iframe%20or%20canvas%20then%20preform%20actions%0Aif(document.activeElement.tagName%20%3D%3D%3D%20%22CANVAS%22)%7B%0A%20%20%20%20streamCanvas(document.activeElement)%3B%0A%7D%0Aelse%20if(document.activeElement.tagName%20%3D%3D%3D%20%22IFRAME%22)%7B%0A%20%20%20%20alert(%22Please%20enable%20popups%22)%3B%0A%20%20%20%20window.open(document.activeElement.src)%3B%0A%7D%0Aelse%7B%0A%20%20%20%20%2F%2FPrompts%20user%20to%20select%20iframe%20or%20canvas%20if%20not%20focused%0A%20%20%20%20let%20canvases%20%3D%20document.getElementsByTagName(%22canvas%22)%3B%0A%20%20%20%20let%20iframes%20%3D%20document.getElementsByTagName(%22iframe%22)%3B%0A%20%20%20%20if(canvases.length%20%3E%200)%7B%0A%20%20%20%20%20%20%20%20let%20response%20%3D%20%22Input%20number%20for%20canvas%20you%20want%20to%20stream(-1%20if%20you%20want%20to%20open%20iframe)%3A%22%3B%0A%20%20%20%20%20%20%20%20for(let%20i%20%3D%200%3Bi%20%3C%20canvases.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20response%20%2B%3D%20(i%20%2B%20%22.%22%20%2B%20canvases%5Bi%5D.id)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20let%20i%20%3D%20%2Bprompt(response)%3B%0A%0A%20%20%20%20%20%20%20%20if(%20isNaN(i)%20%7C%7C%20i%20%3C%20-1%20%7C%7C%20i%20%3E%3D%20canvases.length)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20alert(%22Improper%20input.%20Terminating%22)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20streamCanvas(canvases%5Bi%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20else%20if(iframes.length%20%3E%200)%7B%0A%20%20%20%20%20%20%20%20let%20response%20%3D%20%22Input%20number%20for%20iframe%20you%20want%20to%20open%20in%20new%20window%3A%22%3B%0A%20%20%20%20%20%20%20%20for(let%20i%20%3D%200%3Bi%20%3C%20iframes.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20response%20%2B%3D%20(i%20%2B%20%22.%22%20%2B%20iframes%5Bi%5D.id)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20let%20i%20%3D%20%2Bprompt(response)%3B%0A%0A%20%20%20%20%20%20%20%20if(%20isNaN(i)%20%7C%7C%20i%20%3C%200%20%7C%7C%20i%20%3E%3D%20iframes.length)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20alert(%22Improper%20input.%20Terminating%22)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20window.open(iframes%5Bi%5D.src)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20else%7B%0A%20%20%20%20%20%20%20%20alert(%22Sorry%20cant%20play%20the%20game%20multiplayer%22)%3B%0A%20%20%20%20%7D%0A%7D%7D)()%3B>

